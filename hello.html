<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KAMBA Forum - Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #2f3136;
        color: #fff;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }
    /* Left server bar */
    .server-bar {
        width: 70px;
        background-color: #202225;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 0;
        gap: 15px;
    }
    .server-icon {
        width: 50px;
        height: 50px;
        background-color: #36393f;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 22px;
        cursor: pointer;
    }
    /* Sidebar */
    .sidebar {
        width: 220px;
        background-color: #2f3136;
        display: flex;
        flex-direction: column;
        padding: 10px;
    }
    .sidebar .search {
        padding: 5px;
        background-color: #202225;
        border: none;
        border-radius: 5px;
        color: white;
    }
    .sidebar h3 {
        margin: 15px 0 5px;
        font-size: 14px;
        color: #b9bbbe;
    }
    /* Chat area */
    .chat {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    .messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
    }
    .message {
        display: flex;
        align-items: flex-start;
        margin-bottom: 15px;
    }
    .message .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #7289da;
        margin-right: 10px;
    }
    .message-content {
        background-color: #36393f;
        padding: 10px;
        border-radius: 5px;
        max-width: 70%;
    }
    /* Input area */
    .input-area {
        display: flex;
        padding: 10px;
        background-color: #40444b;
        align-items: center;
        gap: 10px;
    }
    .input-area input[type="text"] {
        flex: 1;
        background-color: #2f3136;
        border: none;
        color: white;
        padding: 10px;
        border-radius: 5px;
    }
    .input-area button {
        background-color: #5865f2;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        color: white;
        cursor: pointer;
    }
    /* Responsive */
    @media (max-width: 768px) {
        .sidebar {
            display: none;
        }
    }
</style>
</head>
<body>

<!-- Server icons bar -->
<div class="server-bar">
    <div class="server-icon"><i class="fa-solid fa-plus"></i></div>
    <div class="server-icon"><i class="fa-solid fa-bullhorn"></i></div>
</div>

<!-- Sidebar -->
<div class="sidebar">
    <input class="search" type="text" placeholder="Search..." id="searchBar">
    <h3>Announcements</h3>
    <h3>Sub-Communities</h3>
    <h3>My Projects</h3>
</div>

<!-- Chat area -->
<div class="chat">
    <div class="messages" id="messages">
        <!-- Messages appear here -->
    </div>
    <div class="input-area">
        <input type="text" id="messageInput" placeholder="Type a message...">
        <button id="sendMessageBtn"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
</div>

<script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCW2RJIku0JLJZTUu0YA9yKO8zjtX29fAo",
        authDomain: "muah-feed.firebaseapp.com",
        databaseURL: "https://muah-feed-default-rtdb.firebaseio.com",
        projectId: "muah-feed",
        storageBucket: "muah-feed.firebasestorage.app",
        messagingSenderId: "442314397706",
        appId: "1:442314397706:web:a69e3958257fb13b3667f3",
        measurementId: "G-S86S229F1T"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    function setupEventListeners() {
        const sendBtn = document.getElementById("sendMessageBtn");
        const messageInput = document.getElementById("messageInput");

        sendBtn.addEventListener("click", async () => {
            const text = messageInput.value.trim();
            if (text) {
                await addDoc(collection(db, "messages"), {
                    text,
                    user: auth.currentUser?.email || "Guest",
                    timestamp: serverTimestamp()
                });
                messageInput.value = "";
            }
        });

        // Load messages
        const q = query(collection(db, "messages"), orderBy("timestamp", "asc"));
        onSnapshot(q, (snapshot) => {
            const messagesDiv = document.getElementById("messages");
            messagesDiv.innerHTML = "";
            snapshot.forEach(doc => {
                const data = doc.data();
                const msgDiv = document.createElement("div");
                msgDiv.classList.add("message");
                msgDiv.innerHTML = `
                    <div class="avatar"></div>
                    <div class="message-content">
                        <strong>${data.user}</strong><br>${data.text}
                    </div>
                `;
                messagesDiv.appendChild(msgDiv);
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    document.addEventListener("DOMContentLoaded", setupEventListeners);

    onAuthStateChanged(auth, user => {
        if (!user) {
            window.location.href = "sign.html";
        }
    });
</script>
</body>
</html>
