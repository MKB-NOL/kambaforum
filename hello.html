<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KAMBA Forum - Chat</title>

<!-- Discord-like fonts and icons -->
<style>
  @import url('https://fonts.googleapis.com/css2?family=Whitney:wght@300;500;600&display=swap');

  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Whitney, "Helvetica Neue", Helvetica, Arial, sans-serif;
    background-color: #36393f;
    color: #dcddde;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  a {
    color: #00b0f4;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Layout grid: Left sidebar, second sidebar, main chat */
  #app {
    display: grid;
    grid-template-columns: 72px 240px 1fr;
    grid-template-rows: 100vh;
  }

  /* Left sidebar (groups) */
  #sidebar-left {
    background-color: #202225;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 12px;
  }
  #sidebar-left .server-icon {
    width: 48px;
    height: 48px;
    border-radius: 24px;
    background-color: #5865f2;
    margin-bottom: 12px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: 700;
    font-size: 22px;
    color: white;
    transition: border-radius 0.2s ease;
  }
  #sidebar-left .server-icon:hover {
    border-radius: 16px;
    background-color: #4752c4;
  }

  /* Middle sidebar */
  #sidebar-main {
    background-color: #2f3136;
    display: flex;
    flex-direction: column;
    padding: 12px 0;
  }
  #sidebar-main header {
    font-weight: 600;
    font-size: 16px;
    color: #b9bbbe;
    padding-left: 20px;
    margin-bottom: 12px;
  }
  #sidebar-main .section {
    flex: 1;
    overflow-y: auto;
    padding-left: 12px;
  }
  #sidebar-main .section h2 {
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    color: #72767d;
    margin: 8px 0 4px 0;
  }
  #sidebar-main .list-item {
    padding: 8px 16px;
    border-radius: 4px;
    color: #dcddde;
    font-size: 15px;
    cursor: pointer;
    transition: background-color 0.15s ease;
  }
  #sidebar-main .list-item:hover {
    background-color: #393c43;
  }

  /* Search bar */
  #sidebar-main #search-bar {
    margin: 0 12px 12px 12px;
    position: relative;
  }
  #sidebar-main #search-input {
    width: 100%;
    padding: 8px 36px 8px 12px;
    border-radius: 4px;
    border: none;
    background-color: #202225;
    color: #dcddde;
    font-size: 14px;
  }
  #sidebar-main #search-input::placeholder {
    color: #72767d;
  }
  #sidebar-main #search-clear-btn {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #72767d;
    cursor: pointer;
    font-size: 16px;
    display: none;
  }
  #sidebar-main #search-input:not(:placeholder-shown) + #search-clear-btn {
    display: block;
  }
  #sidebar-main #search-results {
    max-height: 150px;
    overflow-y: auto;
    margin-top: 8px;
  }
  #sidebar-main #search-results .list-item {
    font-size: 14px;
    color: #b9bbbe;
  }

  /* Main chat area */
  #chat-area {
    display: flex;
    flex-direction: column;
    background-color: #36393f;
  }

  /* Chat header */
  #chat-header {
    padding: 16px 20px;
    border-bottom: 1px solid #2f3136;
    font-weight: 600;
    font-size: 18px;
    color: white;
  }

  /* Messages container */
  #chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* Individual message bubble */
  .message {
    max-width: 75%;
    background-color: #2f3136;
    border-radius: 8px;
    padding: 8px 12px;
    color: #dcddde;
    font-size: 14px;
    line-height: 1.4;
    position: relative;
  }
  .message .username {
    font-weight: 600;
    margin-bottom: 4px;
    user-select: none;
  }
  .message.green .username {
    color: #43b581;
  }
  .message.blue .username {
    color: #5865f2;
  }
  .message.violet .username {
    color: #9b59b6;
  }
  .message.red .username {
    color: #f04747;
  }
  .message .reply-to {
    font-style: italic;
    font-size: 12px;
    color: #b9bbbe;
    border-left: 3px solid #5865f2;
    margin-bottom: 4px;
    padding-left: 6px;
  }

  /* Images inside messages */
  .message img.chat-image {
    max-width: 100%;
    border-radius: 6px;
    margin-top: 6px;
    cursor: pointer;
    transition: filter 0.2s ease;
  }
  .message img.chat-image:hover {
    filter: brightness(1.15);
  }
  .img-save-icon {
    position: absolute;
    bottom: 6px;
    right: 6px;
    font-size: 16px;
    color: #b9bbbe;
    background: rgba(0,0,0,0.5);
    padding: 2px 4px;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }

  /* Reply button */
  .reply-btn {
    margin-top: 6px;
    font-size: 13px;
    font-weight: 600;
    color: #00b0f4;
    cursor: pointer;
    user-select: none;
  }
  .reply-btn:hover {
    text-decoration: underline;
  }

  /* Message input area */
  #chat-input-area {
    background-color: #40444b;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  #emoji-btn, #send-btn, #image-upload-label {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #b9bbbe;
    user-select: none;
  }
  #emoji-btn:hover, #send-btn:hover, #image-upload-label:hover {
    color: white;
  }
  #message-input {
    flex-grow: 1;
    border: none;
    border-radius: 4px;
    padding: 8px 12px;
    font-size: 14px;
    background-color: #2f3136;
    color: #dcddde;
    resize: none;
    min-height: 36px;
    max-height: 120px;
    overflow-y: auto;
  }
  #message-input::placeholder {
    color: #72767d;
  }
  #message-input:focus {
    outline: none;
    background-color: #40444b;
  }

  /* Fullscreen image viewer */
  #fullscreen-img-viewer {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(0,0,0,0.9);
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  #fullscreen-img-viewer img {
    max-width: 90%;
    max-height: 90%;
    border-radius: 8px;
  }

  /* No-song notification */
  #no-song-notification {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #f04747;
    color: white;
    padding: 10px 20px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    cursor: pointer;
    z-index: 9999;
  }
  #no-song-notification button {
    background: rgba(255 255 255 / 0.3);
    border: none;
    border-radius: 12px;
    padding: 4px 10px;
    color: white;
    font-weight: 600;
    cursor: pointer;
  }
  #no-song-notification button:hover {
    background: rgba(255 255 255 / 0.5);
  }

  /* Scrollbars - consistent dark style */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background-color: #202225;
    border-radius: 4px;
  }
  ::-webkit-scrollbar-track {
    background-color: #2f3136;
  }

  /* Responsive */
  @media (max-width: 768px) {
    #app {
      grid-template-columns: 56px 180px 1fr;
    }
    #sidebar-main {
      display: none;
    }
  }
  @media (max-width: 480px) {
    #app {
      grid-template-columns: 56px 0 1fr;
    }
  }
</style>
</head>
<body>
<div id="app" role="main" aria-label="KAMBA Forum chat application">

  <!-- Left sidebar (servers/groups) -->
  <nav id="sidebar-left" aria-label="Groups sidebar">
    <div class="server-icon" title="General Group">G</div>
    <!-- Add dynamic group icons here -->
  </nav>

  <!-- Main sidebar -->
  <aside id="sidebar-main" aria-label="Main sidebar">
    <header>KAMBA Forum</header>

    <div id="search-bar">
      <input id="search-input" type="search" placeholder="Search users, projects, groups..." aria-label="Search" />
      <button id="search-clear-btn" aria-label="Clear search">âœ•</button>
      <div id="search-results" role="listbox" aria-live="polite" aria-relevant="additions"></div>
    </div>

    <section class="section" aria-label="Announcements">
      <h2>Announcements</h2>
      <div id="announcements-list" role="list"></div>
    </section>

    <section class="section" aria-label="Sub-Communities">
      <h2>Sub-Communities</h2>
      <div id="subcommunities-list" role="list"></div>
    </section>

    <section class="section" aria-label="My Projects">
      <h2>My Projects</h2>
      <div id="my-projects-list" role="list"></div>
    </section>
  </aside>

  <!-- Chat area -->
  <main id="chat-area">
    <header id="chat-header" aria-live="polite" aria-atomic="true">
      Welcome to KAMBA Forum
      <div id="profile-icon" role="button" aria-label="User Profile" tabindex="0" title="Go to Settings"></div>
    </header>

    <div id="chat-messages" role="log" aria-live="polite" aria-relevant="additions"></div>

    <!-- No song notification -->
    <div id="no-song-notification" role="alert" aria-live="assertive" style="display:none;">
      No song set. Click here to set your song in <strong>Settings</strong>.
      <button id="dismiss-no-song-btn" aria-label="Dismiss notification for 10 hours">Dismiss</button>
    </div>

    <div id="chat-input-area">
      <button id="emoji-btn" title="Show emojis" aria-label="Show emojis">ðŸ˜Š</button>
      <textarea id="message-input" placeholder="Message #general" rows="1" aria-multiline="true"></textarea>
      <label for="image-upload-input" id="image-upload-label" title="Upload images" aria-label="Upload images">ðŸ“·</label>
      <input type="file" id="image-upload-input" accept="image/*" multiple style="display:none" aria-hidden="true" />
      <button id="send-btn" aria-label="Send message">Send</button>
    </div>
  </main>
</div>

<!-- Fullscreen image viewer -->
<div id="fullscreen-img-viewer" role="dialog" aria-modal="true" tabindex="-1">
  <img src="" alt="Full screen preview image" />
</div>

<script type="module">
// Your Firebase config and JS here (reuse the logic from the previous complete script for auth, chat, messages, image upload, emojis, etc.)
// The UI logic stays the same, just styling changed above.
// For brevity, I omitted the entire JS here, but you should include the previous functional script with minor adjustments
// to match new IDs and structure if needed.

</script>
</body>
</html>
